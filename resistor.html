<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>STARLET - Login & Signup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      background: linear-gradient(135deg, #4f46e5, #3b82f6);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .glass {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 2rem;
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }

    input:focus, select:focus {
      border-color: #6366f1;
      outline: none;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3);
    }
  </style>
</head>
<body>

  <div class="w-full max-w-md glass p-8 sm:p-10 text-white space-y-6">
    <div class="text-center">
      <h2 class="text-4xl font-bold text-white drop-shadow">STARLET</h2>
      <p class="text-indigo-100" id="formTitle">Login to your account</p>
    </div>

    <form id="authForm" class="space-y-5">
      <div id="nameField" class="hidden">
        <label class="block text-sm">Full Name</label>
        <input type="text" id="name" class="w-full p-3 rounded-xl bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-70" placeholder="Your Name" />
      </div>

      <div id="mobileField" class="hidden">
        <label class="block text-sm">Mobile Number</label>
        <input type="text" id="mobile" class="w-full p-3 rounded-xl bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-70" placeholder="10-digit mobile" />
      </div>

      <div id="courseField" class="hidden">
        <label class="block text-sm">Choose Course</label>
        <select id="course" class="w-full p-3 rounded-xl bg-white bg-opacity-20 text-black">
          <option value="">Select</option>
          <option value="BSc 1st Year">BSc 1st Year</option>
          <option value="BSc 2nd Year">BSc 2nd Year</option>
          <option value="BSc 3rd Year">BSc 3rd Year</option>
        </select>
      </div>

      <div>
        <label class="block text-sm">Email</label>
        <input type="email" id="email" class="w-full p-3 rounded-xl bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-70" placeholder="email@example.com" required />
      </div>

      <div>
        <label class="block text-sm">Password</label>
        <input type="password" id="password" class="w-full p-3 rounded-xl bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-70" placeholder="********" required />
      </div>

      <div class="flex justify-between text-sm">
        <a href="#" id="forgotPassword" class="text-blue-200 hover:underline">Forgot Password?</a>
        <button type="button" id="toggleForm" class="text-blue-200 hover:underline">Don't have an account? Sign Up</button>
      </div>

      <button type="submit" id="authBtn"
        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white p-3 rounded-xl font-semibold transition-all duration-200 flex items-center justify-center gap-2">
        <span id="authText">Login</span>
        <svg id="spinner" class="hidden animate-spin h-5 w-5 text-white"
          xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"/>
        </svg>
      </button>

      <div id="payNow" class="hidden text-center">
        <p class="text-yellow-200 font-semibold mt-4">You haven't purchased access yet.</p>
        <a href="GPay.html" class="inline-block mt-2 px-6 py-3 bg-green-500 text-white rounded-xl hover:bg-green-600 transition">Pay Now</a>
      </div>
    </form>
  </div>

  <!-- Firebase SDK & Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import {
      getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword,
      sendPasswordResetEmail, signOut
    } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
    import {
      getFirestore, setDoc, doc, getDoc
    } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCOKKBSbZJk8QSGvj1CPYQb_kjQb1tXO6s",
      authDomain: "starlet-registor.firebaseapp.com",
      projectId: "starlet-registor",
      storageBucket: "starlet-registor.appspot.com",
      messagingSenderId: "904193225045",
      appId: "1:904193225045:web:0c9ed3f3d7251862ff7fdc",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let isLogin = true;
    const toggleFormBtn = document.getElementById("toggleForm");
    const authText = document.getElementById("authText");
    const formTitle = document.getElementById("formTitle");

    const updateFormMode = () => {
      document.getElementById("nameField").classList.toggle("hidden", isLogin);
      document.getElementById("mobileField").classList.toggle("hidden", isLogin);
      document.getElementById("courseField").classList.toggle("hidden", isLogin);
      formTitle.textContent = isLogin ? "Login to your account" : "Create a new account";
      authText.textContent = isLogin ? "Login" : "Sign Up";
      toggleFormBtn.textContent = isLogin ? "Don't have an account? Sign Up" : "Already have an account? Login";
    };

    toggleFormBtn.addEventListener("click", () => {
      isLogin = !isLogin;
      updateFormMode();
    });

    document.getElementById("authForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      const spinner = document.getElementById("spinner");
      const authBtn = document.getElementById("authBtn");

      authText.textContent = isLogin ? "Logging in..." : "Signing up...";
      spinner.classList.remove("hidden");
      authBtn.disabled = true;

      try {
        if (isLogin) {
          const userCredential = await signInWithEmailAndPassword(auth, email, password);
          const docRef = doc(db, "users", userCredential.user.uid);
          const docSnap = await getDoc(docRef);

          if (docSnap.exists() && docSnap.data().hasAccess) {
            alert("Login successful!");
            window.location.href = "dashboard.html";
          } else {
            document.getElementById("payNow").classList.remove("hidden");
            await signOut(auth);
          }

        } else {
          const name = document.getElementById("name").value.trim();
          const mobile = document.getElementById("mobile").value.trim();
          const course = document.getElementById("course").value;

          const userCredential = await createUserWithEmailAndPassword(auth, email, password);
          await setDoc(doc(db, "users", userCredential.user.uid), {
            name,
            email,
            mobile,
            course,
            hasAccess: false
          });

          alert("Signup successful. Please wait for access approval.");
          isLogin = true;
          updateFormMode();
        }

      } catch (error) {
        alert("Error: " + error.message);
      } finally {
        authText.textContent = isLogin ? "Login" : "Sign Up";
        spinner.classList.add("hidden");
        authBtn.disabled = false;
      }
    });

    document.getElementById("forgotPassword").addEventListener("click", async () => {
      const email = prompt("Enter your email to receive reset link:");
      if (email) {
        try {
          await sendPasswordResetEmail(auth, email);
          alert("Password reset email sent.");
        } catch (error) {
          alert("Error: " + error.message);
        }
      }
    });
  </script>
</body>
</html>