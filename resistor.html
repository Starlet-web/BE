<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>STARLET Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
    }
    .bg-glow {
      background: linear-gradient(to right, #667eea, #764ba2);
    }
  </style>
</head>
<body class="bg-glow min-h-screen flex items-center justify-center p-4">

  <div class="bg-white shadow-2xl rounded-3xl w-full max-w-3xl grid grid-cols-1 md:grid-cols-2 overflow-hidden">
    
    <!-- Left -->
    <div class="bg-indigo-600 text-white p-10 flex flex-col justify-center">
      <h1 class="text-4xl font-bold mb-4">Welcome to STARLET</h1>
      <p class="text-lg">BSc Bio Classes for 1st, 2nd & 3rd Year</p>
    </div>

    <!-- Right (Form) -->
    <div class="p-8 space-y-5">
      <h2 class="text-2xl font-semibold text-center text-gray-800 mb-4" id="formTitle">Login to your account</h2>

      <form id="authForm" class="space-y-4">
        <div id="extraFields" class="hidden space-y-4">
          <input id="name" type="text" placeholder="Full Name" class="w-full px-4 py-3 border rounded-lg" required>
          <input id="mobile" type="tel" placeholder="Mobile Number" class="w-full px-4 py-3 border rounded-lg" required>
          <select id="course" class="w-full px-4 py-3 border rounded-lg" required>
            <option value="">Choose Course</option>
            <option value="BSc 1st Year">BSc 1st Year</option>
            <option value="BSc 2nd Year">BSc 2nd Year</option>
            <option value="BSc 3rd Year">BSc 3rd Year</option>
          </select>
        </div>

        <input id="email" type="email" placeholder="Email" class="w-full px-4 py-3 border rounded-lg" required>
        <input id="password" type="password" placeholder="Password" class="w-full px-4 py-3 border rounded-lg" required>

        <div class="flex justify-between text-sm text-gray-600">
          <a href="#" id="forgotPassword" class="underline hover:text-indigo-600">Forgot Password?</a>
          <button type="button" id="toggleForm" class="underline hover:text-indigo-600">Don't have an account? Sign Up</button>
        </div>

        <button type="submit" id="authBtn"
          class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition duration-200">
          <span id="authText">Login</span>
        </button>

        <a href="GPay.html" id="payNowBtn" class="hidden w-full block text-center mt-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">Pay Now</a>
      </form>
    </div>
  </div>

  <!-- Firebase SDK and Auth Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import {
      getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword,
      sendPasswordResetEmail, sendEmailVerification, signOut
    } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
    import {
      getFirestore, doc, setDoc, getDoc
    } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCOKKBSbZJk8QSGvj1CPYQb_kjQb1tXO6s",
      authDomain: "starlet-registor.firebaseapp.com",
      projectId: "starlet-registor",
      storageBucket: "starlet-registor.appspot.com",
      messagingSenderId: "904193225045",
      appId: "1:904193225045:web:0c9ed3f3d7251862ff7fdc"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let isLogin = true;

    document.getElementById("toggleForm").addEventListener("click", () => {
      isLogin = !isLogin;
      document.getElementById("formTitle").textContent = isLogin ? "Login to your account" : "Create a new account";
      document.getElementById("authText").textContent = isLogin ? "Login" : "Sign Up";
      document.getElementById("toggleForm").textContent = isLogin ? "Don't have an account? Sign Up" : "Already have an account? Login";
      document.getElementById("extraFields").classList.toggle("hidden", isLogin);
      document.getElementById("payNowBtn").classList.add("hidden");
    });

    document.getElementById("authForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;

      if (isLogin) {
        try {
          const userCredential = await signInWithEmailAndPassword(auth, email, password);
          const user = userCredential.user;

          if (!user.emailVerified) {
            alert("Please verify your email before logging in.");
            await signOut(auth);
            return;
          }

          const userDoc = await getDoc(doc(db, "users", user.uid));
          if (userDoc.exists()) {
            const data = userDoc.data();
            if (data.hasAccess) {
              alert("Login successful!");
              window.location.href = "dashboard.html";
            } else {
              document.getElementById("payNowBtn").classList.remove("hidden");
              alert("Access denied. Please complete payment.");
            }
          }
        } catch (err) {
          alert("Login failed: " + err.message);
        }
      } else {
        const name = document.getElementById("name").value.trim();
        const mobile = document.getElementById("mobile").value.trim();
        const course = document.getElementById("course").value;

        if (!name || !mobile || !course) {
          alert("Please fill all the fields.");
          return;
        }

        try {
          const userCredential = await createUserWithEmailAndPassword(auth, email, password);
          const user = userCredential.user;

          await setDoc(doc(db, "users", user.uid), {
            name, mobile, course, email, hasAccess: false
          });

          await sendEmailVerification(user);
          alert("Signup successful! Verification email sent. Please verify to login.");
          await signOut(auth);
        } catch (err) {
          alert("Signup failed: " + err.message);
        }
      }
    });

    document.getElementById("forgotPassword").addEventListener("click", async () => {
      const email = prompt("Enter your email to reset password:");
      if (email) {
        try {
          await sendPasswordResetEmail(auth, email);
          alert("Password reset email sent.");
        } catch (error) {
          alert("Error: " + error.message);
        }
      }
    });
  </script>
</body>
</html>
