<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Starlet Bio Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #eef2ff 100%);
      min-height: 100vh;
    }
    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.4);
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.08);
    }
    .btn-primary {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      color: white;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(99, 102, 241, 0.35);
    }
    .btn-secondary {
      background: rgba(99, 102, 241, 0.1);
      color: #6366f1;
      transition: all 0.3s ease;
      border: 1px solid rgba(99, 102, 241, 0.2);
      cursor: pointer;
    }
    .btn-secondary:hover {
      background: rgba(99, 102, 241, 0.15);
      transform: translateY(-1px);
    }
    .progress-ring {
      transform: rotate(-90deg);
    }
    .progress-ring-circle {
      transition: stroke-dashoffset 0.5s ease;
    }
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ef4444;
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .loading-shimmer {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    .whiteboard-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      z-index: 100;
      display: none;
      flex-direction: column;
    }
    .whiteboard-header {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      color: white;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .whiteboard-iframe {
      flex: 1;
      border: none;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 50;
      display: none;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      text-align: center;
    }
  </style>
</head>

<body class="min-h-screen p-4">
  <div class="max-w-md mx-auto">

    <!-- Header -->
    <header class="flex justify-between items-center mb-6" id="headerSection">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-gradient-to-br from-indigo-600 to-purple-600 text-white rounded-xl flex items-center justify-center shadow-md">
          <i class="fas fa-dna"></i>
        </div>
        <div>
          <h1 class="font-bold text-xl bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
            Starlet Bio
          </h1>
          <p class="text-xs text-gray-500">Learning Dashboard</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <div class="relative">
          <button id="notificationBtn" class="w-8 h-8 bg-white text-indigo-600 rounded-full flex items-center justify-center font-medium shadow-sm hover:shadow-md transition-all">
            <i class="fas fa-bell"></i>
          </button>
          <span class="notification-badge" id="notificationCount">3</span>
        </div>
        <div class="w-8 h-8 bg-gradient-to-br from-indigo-100 to-purple-100 text-indigo-600 rounded-full flex items-center justify-center font-medium shadow-inner" id="userAvatar">
          <i class="fas fa-user animate-pulse"></i>
        </div>
      </div>
    </header>

    <!-- Welcome Message -->
    <div class="card p-5 mb-6 relative overflow-hidden">
      <div class="absolute -right-4 -top-4 w-20 h-20 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-full opacity-70"></div>
      <h2 class="text-lg font-semibold text-indigo-700 mb-1" id="welcomeMessage">Welcome back ðŸ‘‹</h2>
      <p class="text-sm text-gray-500 mb-3" id="studentTagline">Loading your dashboard...</p>
      <div class="flex gap-2">
        <button class="btn-secondary text-xs px-3 py-1.5 rounded-lg font-medium flex items-center gap-1" id="profileBtn">
          <i class="fas fa-user"></i> Profile
        </button>
        <button class="btn-secondary text-xs px-3 py-1.5 rounded-lg font-medium flex items-center gap-1" id="logoutBtn">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </div>

    <!-- Personal Stats Section -->
    <div class="grid grid-cols-2 gap-4 mb-6" id="statsSection">
      <div class="card p-4 relative">
        <div class="flex justify-between items-start">
          <div>
            <p class="text-gray-500 text-xs mb-1">Attendance</p>
            <p class="font-bold text-xl text-indigo-700" id="attendancePercent">--%</p>
          </div>
          <div class="w-12 h-12">
            <svg class="w-full h-full" viewBox="0 0 42 42">
              <circle cx="21" cy="21" r="15.9155" fill="transparent" stroke="#e2e8f0" stroke-width="3"></circle>
              <circle id="attendanceRing" class="progress-ring-circle" cx="21" cy="21" r="15.9155" fill="transparent" stroke="#6366f1" stroke-width="3" stroke-dasharray="100" stroke-dashoffset="100" stroke-linecap="round"></circle>
            </svg>
          </div>
        </div>
        <div class="h-1.5 bg-gray-100 rounded-full mt-3 overflow-hidden">
          <div id="attendanceBar" class="h-full bg-indigo-500 rounded-full transition-all duration-700" style="width: 0%"></div>
        </div>
      </div>

      <div class="card p-4 relative">
        <div class="flex justify-between items-start">
          <div>
            <p class="text-gray-500 text-xs mb-1">Overall Progress</p>
            <p class="font-bold text-xl text-purple-700" id="progressPercent">--%</p>
          </div>
          <div class="w-12 h-12">
            <svg class="w-full h-full" viewBox="0 0 42 42">
              <circle cx="21" cy="21" r="15.9155" fill="transparent" stroke="#e2e8f0" stroke-width="3"></circle>
              <circle id="progressRing" class="progress-ring-circle" cx="21" cy="21" r="15.9155" fill="transparent" stroke="#8b5cf6" stroke-width="3" stroke-dasharray="100" stroke-dashoffset="100" stroke-linecap="round"></circle>
            </svg>
          </div>
        </div>
        <div class="h-1.5 bg-gray-100 rounded-full mt-3 overflow-hidden">
          <div id="progressBar" class="h-full bg-purple-500 rounded-full transition-all duration-700" style="width: 0%"></div>
        </div>
      </div>
    </div>

    <!-- Marks & Rank -->
    <div class="grid gap-4 mb-6">
      <div class="card p-5">
        <h2 class="font-semibold text-indigo-700 mb-3 flex items-center gap-2"><i class="fas fa-chart-line"></i> Academic Performance</h2>
        <div class="grid grid-cols-2 gap-4">
          <div class="text-center p-3 bg-indigo-50 rounded-lg">
            <p class="text-xs text-gray-600 mb-1">Latest Test</p>
            <p class="font-semibold text-indigo-700" id="latestTest">--</p>
          </div>
          <div class="text-center p-3 bg-purple-50 rounded-lg">
            <p class="text-xs text-gray-600 mb-1">Score</p>
            <p class="font-semibold text-purple-700" id="marksScored">--/100</p>
          </div>
          <div class="text-center p-3 bg-indigo-50 rounded-lg">
            <p class="text-xs text-gray-600 mb-1">Class Rank</p>
            <p class="font-semibold text-indigo-700" id="rankPosition">--</p>
          </div>
          <div class="text-center p-3 bg-purple-50 rounded-lg">
            <p class="text-xs text-gray-600 mb-1">Improvement</p>
            <p class="font-semibold text-purple-700" id="improvement">+2.5%</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="mb-6">
      <h2 class="font-semibold text-gray-700 mb-3">Quick Actions</h2>
      <div class="grid grid-cols-4 gap-3">
        <button class="card p-3 flex flex-col items-center justify-center text-center transition-all hover:shadow-md" id="timetableBtn">
          <div class="w-10 h-10 bg-indigo-100 text-indigo-600 rounded-lg flex items-center justify-center mb-2">
            <i class="fas fa-calendar-alt"></i>
          </div>
          <span class="text-xs font-medium">Timetable</span>
        </button>
        <button class="card p-3 flex flex-col items-center justify-center text-center transition-all hover:shadow-md" id="assignmentsBtn">
          <div class="w-10 h-10 bg-purple-100 text-purple-600 rounded-lg flex items-center justify-center mb-2">
            <i class="fas fa-tasks"></i>
          </div>
          <span class="text-xs font-medium">Assignments</span>
        </button>
        <button class="card p-3 flex flex-col items-center justify-center text-center transition-all hover:shadow-md" id="resourcesBtn">
          <div class="w-10 h-10 bg-indigo-100 text-indigo-600 rounded-lg flex items-center justify-center mb-2">
            <i class="fas fa-book"></i>
          </div>
          <span class="text-xs font-medium">Resources</span>
        </button>
        <button class="card p-3 flex flex-col items-center justify-center text-center transition-all hover:shadow-md" id="supportBtn">
          <div class="w-10 h-10 bg-purple-100 text-purple-600 rounded-lg flex items-center justify-center mb-2">
            <i class="fas fa-headset"></i>
          </div>
          <span class="text-xs font-medium">Support</span>
        </button>
      </div>
    </div>

    <!-- Class and Material Cards -->
    <div class="grid gap-4 mb-6" id="actionsSection">
      <div class="card p-5">
        <h2 class="font-semibold mb-3 flex items-center gap-2 text-indigo-700">
          <i class="fas fa-video"></i><span>Live Class</span>
        </h2>
        <button class="btn-primary w-full py-3 rounded-lg font-medium flex items-center justify-center gap-2 mb-2" id="joinClassBtn">
          <i class="fas fa-play"></i> Join Now
        </button>
        <button class="btn-secondary w-full py-3 rounded-lg font-medium flex items-center justify-center gap-2 mb-2" id="openWhiteboardBtn">
          <i class="fas fa-chalkboard"></i> Open Whiteboard
        </button>
        <div class="flex justify-between text-xs text-gray-500">
          <span class="flex items-center">
            <i class="fas fa-clock text-indigo-500 mr-1"></i>
            Today 2:00 PM
          </span>
          <span class="flex items-center">
            <i class="fas fa-book text-indigo-500 mr-1"></i>
            Biotechnology
          </span>
        </div>
      </div>

      <div class="card p-5">
        <h2 class="font-semibold mb-3 flex items-center gap-2 text-indigo-700">
          <i class="fas fa-film"></i><span>Recorded Lectures</span>
        </h2>
        <button class="btn-primary w-full py-3 rounded-lg font-medium flex items-center justify-center gap-2 mb-2" id="recordedLecturesBtn">
          <i class="fas fa-video-circle"></i> Watch Now
        </button>
        <p class="text-xs text-gray-500 flex items-center">
          <i class="fas fa-info-circle text-indigo-500 mr-1"></i> Access previous sessions anytime
        </p>
      </div>

      <div class="card p-5">
        <h2 class="font-semibold mb-3 flex items-center gap-2 text-purple-700">
          <i class="fas fa-book-open"></i><span>Study Materials</span>
        </h2>
        <button class="btn-primary w-full py-3 rounded-lg font-medium flex items-center justify-center gap-2 mb-2" id="downloadMaterialsBtn">
          <i class="fas fa-download"></i> Download
        </button>
        <p class="text-xs text-gray-500 flex items-center">
          <i class="fas fa-file-alt text-purple-500 mr-1"></i> Latest notes & practice sheets
        </p>
      </div>
    </div>

    <!-- Upcoming Events -->
    <div class="card p-5 mb-6">
      <h2 class="font-semibold mb-3 flex items-center gap-2 text-gray-700">
        <i class="fas fa-calendar-day"></i><span>Upcoming Events</span>
      </h2>
      <div class="space-y-3">
        <div class="flex items-center gap-3 p-2 hover:bg-indigo-50 rounded-lg transition-colors">
          <div class="w-10 h-10 bg-indigo-100 text-indigo-600 rounded-lg flex flex-col items-center justify-center text-xs font-bold">
            <span>15</span>
            <span>MAR</span>
          </div>
          <div>
            <p class="text-sm font-medium">Weekly Test</p>
            <p class="text-xs text-gray-500">Genetics & Evolution</p>
          </div>
        </div>
        <div class="flex items-center gap-3 p-2 hover:bg-purple-50 rounded-lg transition-colors">
          <div class="w-10 h-10 bg-purple-100 text-purple-600 rounded-lg flex flex-col items-center justify-center text-xs font-bold">
            <span>18</span>
            <span>MAR</span>
          </div>
          <div>
            <p class="text-sm font-medium">Guest Lecture</p>
            <p class="text-xs text-gray-500">Dr. Sharma - Cell Biology</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="text-center text-xs text-gray-500 mt-6 pb-4">
      <div class="flex justify-center gap-5 mb-3">
        <a href="#" class="text-indigo-500 hover:text-indigo-700 transition-colors"><i class="fab fa-whatsapp"></i></a>
        <a href="#" class="text-indigo-500 hover:text-indigo-700 transition-colors"><i class="fas fa-envelope"></i></a>
        <a href="#" class="text-indigo-500 hover:text-indigo-700 transition-colors"><i class="fas fa-phone"></i></a>
        <a href="#" class="text-indigo-500 hover:text-indigo-700 transition-colors"><i class="fab fa-telegram"></i></a>
      </div>
      <p class="mb-1">Â© 2025 Starlet Biology Coaching</p>
      <p>Empowering future biologists</p>
    </footer>
  </div>

  <!-- Whiteboard Container -->
  <div class="whiteboard-container" id="whiteboardContainer">
    <div class="whiteboard-header">
      <h2 class="font-semibold">Interactive Whiteboard - Biotechnology</h2>
      <button id="closeWhiteboardBtn" class="bg-white text-indigo-600 w-8 h-8 rounded-full flex items-center justify-center">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <iframe class="whiteboard-iframe" src="https://applications.zoom.us/integration/wb/embedwhiteboard/home?docId=PvyX341xQoiMaccwCCv8uA&pageId=211661377830912&embedId=1761286885485" allowfullscreen></iframe>
  </div>

  <!-- Modal for Class Options -->
  <div class="modal-overlay" id="classOptionsModal">
    <div class="modal-content">
      <h3 class="font-bold text-lg text-indigo-700 mb-4">Join Live Class</h3>
      <p class="text-gray-600 mb-6">How would you like to join the class?</p>
      <div class="flex flex-col gap-3">
        <button class="btn-primary w-full py-3 rounded-lg font-medium flex items-center justify-center gap-2" id="joinZoomBtn">
          <i class="fas fa-video"></i> Join Zoom Meeting
        </button>
        <button class="btn-secondary w-full py-3 rounded-lg font-medium flex items-center justify-center gap-2" id="openWhiteboardModalBtn">
          <i class="fas fa-chalkboard"></i> Open Whiteboard Only
        </button>
        <button class="text-gray-500 py-2 rounded-lg font-medium" id="cancelClassBtn">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCOKKBSbZJk8QSGvj1CPYQb_kjQb1tXO6s",
      authDomain: "starlet-registor.firebaseapp.com",
      projectId: "starlet-registor",
      storageBucket: "starlet-registor.appspot.com",
      messagingSenderId: "904193225045",
      appId: "1:904193225045:web:0c9ed3f3d7251862ff7fdc"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM Elements
    const userAvatar = document.getElementById('userAvatar');
    const welcomeMessage = document.getElementById('welcomeMessage');
    const studentTagline = document.getElementById('studentTagline');
    const attendancePercent = document.getElementById('attendancePercent');
    const progressPercent = document.getElementById('progressPercent');
    const attendanceBar = document.getElementById('attendanceBar');
    const progressBar = document.getElementById('progressBar');
    const attendanceRing = document.getElementById('attendanceRing');
    const progressRing = document.getElementById('progressRing');
    const latestTest = document.getElementById('latestTest');
    const marksScored = document.getElementById('marksScored');
    const rankPosition = document.getElementById('rankPosition');
    const improvement = document.getElementById('improvement');
    const joinClassBtn = document.getElementById('joinClassBtn');
    const downloadMaterialsBtn = document.getElementById('downloadMaterialsBtn');
    const recordedLecturesBtn = document.getElementById('recordedLecturesBtn');
    const profileBtn = document.getElementById('profileBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const notificationBtn = document.getElementById('notificationBtn');
    const notificationCount = document.getElementById('notificationCount');
    const timetableBtn = document.getElementById('timetableBtn');
    const assignmentsBtn = document.getElementById('assignmentsBtn');
    const resourcesBtn = document.getElementById('resourcesBtn');
    const supportBtn = document.getElementById('supportBtn');
    const openWhiteboardBtn = document.getElementById('openWhiteboardBtn');
    const whiteboardContainer = document.getElementById('whiteboardContainer');
    const closeWhiteboardBtn = document.getElementById('closeWhiteboardBtn');
    const classOptionsModal = document.getElementById('classOptionsModal');
    const joinZoomBtn = document.getElementById('joinZoomBtn');
    const openWhiteboardModalBtn = document.getElementById('openWhiteboardModalBtn');
    const cancelClassBtn = document.getElementById('cancelClassBtn');

    // Helper: Get initials
    function getInitials(name) {
      if (!name) return '';
      const names = name.split(' ');
      return names.map(n => n[0]).join('').toUpperCase();
    }

    // Update progress rings
    function updateProgressRing(ring, percent) {
      const circumference = 2 * Math.PI * 15.9155;
      const offset = circumference - (percent / 100) * circumference;
      ring.style.strokeDasharray = `${circumference} ${circumference}`;
      ring.style.strokeDashoffset = offset;
    }

    // Personalize Dashboard
    function updateUserUI(user) {
      // Show loading state
      welcomeMessage.textContent = "Loading your data...";
      studentTagline.textContent = "Please wait";
      
      db.collection('users').doc(user.uid).get().then(doc => {
        if (doc.exists) {
          const data = doc.data();

          // Basic details
          welcomeMessage.textContent = `Welcome back, ${data.name?.split(' ')[0] || 'Student'} ðŸ‘‹`;
          studentTagline.textContent = `Course: ${data.course || 'Biology'}`;
          userAvatar.innerHTML = getInitials(data.name) || '<i class="fas fa-user"></i>';

          // Stats
          const attendance = data.attendance || 0;
          const progress = data.progress || 0;
          
          attendancePercent.textContent = `${attendance}%`;
          progressPercent.textContent = `${progress}%`;
          
          // Animate progress bars
          setTimeout(() => {
            attendanceBar.style.width = `${attendance}%`;
            progressBar.style.width = `${progress}%`;
            updateProgressRing(attendanceRing, attendance);
            updateProgressRing(progressRing, progress);
          }, 300);

          // Marks section
          latestTest.textContent = data.latestTest || 'No record';
          marksScored.textContent = data.marks ? `${data.marks}/100` : '--/100';
          rankPosition.textContent = data.rank || '--';
          improvement.textContent = data.improvement ? `${data.improvement > 0 ? '+' : ''}${data.improvement}%` : '+0%';
        } else {
          // User document doesn't exist
          welcomeMessage.textContent = "Welcome to Starlet Bio!";
          studentTagline.textContent = "Complete your profile to get started";
        }
      }).catch(error => {
        console.error("Error fetching user data:", error);
        welcomeMessage.textContent = "Error loading data";
        studentTagline.textContent = "Please try again later";
      });
    }

    // Button actions
    joinClassBtn.addEventListener('click', () => {
      classOptionsModal.style.display = 'flex';
    });
    
    joinZoomBtn.addEventListener('click', () => {
      // Try to open Zoom, fallback to web
      window.location.href = "zoomus://zoom.us/join?confno=4527503240&pwd=QDw5xc";
      setTimeout(() => {
        window.location.href = "https://zoom.us/j/4527503240?pwd=QDw5xc";
      }, 500);
      classOptionsModal.style.display = 'none';
    });
    
    openWhiteboardModalBtn.addEventListener('click', () => {
      whiteboardContainer.style.display = 'flex';
      classOptionsModal.style.display = 'none';
    });
    
    openWhiteboardBtn.addEventListener('click', () => {
      whiteboardContainer.style.display = 'flex';
    });
    
    closeWhiteboardBtn.addEventListener('click', () => {
      whiteboardContainer.style.display = 'none';
    });
    
    cancelClassBtn.addEventListener('click', () => {
      classOptionsModal.style.display = 'none';
    });
    
    recordedLecturesBtn.addEventListener('click', () => window.location.href = "recorded.html");
    downloadMaterialsBtn.addEventListener('click', () => window.location.href = "3notes.html");
    profileBtn.addEventListener('click', () => window.location.href = "profile.html");
    logoutBtn.addEventListener('click', () => {
      auth.signOut().then(() => {
        window.location.href = "login.html";
      });
    });
    
    // Quick action buttons
    timetableBtn.addEventListener('click', () => window.location.href = "timetable.html");
    assignmentsBtn.addEventListener('click', () => window.location.href = "assignments.html");
    resourcesBtn.addEventListener('click', () => window.location.href = "resources.html");
    supportBtn.addEventListener('click', () => window.location.href = "support.html");
    
    // Notification button
    notificationBtn.addEventListener('click', () => {
      // Toggle notification panel or navigate to notifications page
      window.location.href = "notifications.html";
    });

    // Firebase Auth Listener
    auth.onAuthStateChanged(user => {
      if (user) {
        updateUserUI(user);
      } else {
        window.location.href = "login.html";
      }
    });

    // Add some sample notifications for demo
    setTimeout(() => {
      notificationCount.textContent = '3';
    }, 1000);
  </script>
</body>
</html>
