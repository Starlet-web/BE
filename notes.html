<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>STARLET Coaching - Premium Notes Demo</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
  <style>
    /* [Previous CSS remains exactly the same] */
    /* ... */
  </style>
</head>
<body>

  <!-- [Previous HTML structure remains the same until the script section] -->
  <!-- ... -->

  <script>
    // Set the path to the PDF.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';
    
    // PDF URLs - Modified Dropbox URL to force download
    const pdfUrls = {
      zoology: 'https://www.dropbox.com/scl/fi/bfe9ish3iak5e0s5u7qwo/DOC-20250430-WA0041..pdf?rlkey=0xajjtz2syh4ewj8yczo7o52q&st=ukivx4b2&dl=1', // Changed dl=0 to dl=1
      botany: 'https://example.com/botany.pdf', // Replace with your actual URL
      chemistry: 'https://example.com/chemistry.pdf' // Replace with your actual URL
    };

    // Function to fetch PDF as blob (to handle CORS)
    async function fetchPDF(url) {
      try {
        // For Dropbox, we need to use the direct download link
        if (url.includes('dropbox.com')) {
          url = url.replace('dl=0', 'dl=1');
        }
        
        const response = await fetch(url);
        if (!response.ok) throw new Error('Network response was not ok');
        return await response.blob();
      } catch (error) {
        console.error('Error fetching PDF:', error);
        throw error;
      }
    }

    // Function to render the first 8 pages of a PDF
    async function renderPDF(viewerId, pdfUrl) {
      const container = document.getElementById(viewerId);
      
      try {
        // Clear existing content except the locked overlay
        while (container.firstChild && !container.firstChild.classList.contains('locked-overlay')) {
          container.removeChild(container.firstChild);
        }

        // Show loading indicator
        const loadingDiv = document.createElement('div');
        loadingDiv.style.padding = '20px';
        loadingDiv.style.textAlign = 'center';
        loadingDiv.style.color = 'var(--dark-light)';
        loadingDiv.innerHTML = `
          <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 10px;"></i>
          <p>Loading preview...</p>
        `;
        container.insertBefore(loadingDiv, container.querySelector('.locked-overlay'));

        // Fetch and render the actual PDF
        const pdfBlob = await fetchPDF(pdfUrl);
        const pdfUrlObj = URL.createObjectURL(pdfBlob);
        
        const loadingTask = pdfjsLib.getDocument(pdfUrlObj);
        const pdf = await loadingTask.promise;
        
        // Remove loading indicator
        container.removeChild(loadingDiv);

        // Render first 8 pages or all pages if PDF has less than 8
        const pageCount = Math.min(pdf.numPages, 8);
        
        for (let i = 1; i <= pageCount; i++) {
          const page = await pdf.getPage(i);
          const viewport = page.getViewport({ scale: 1.0 });
          
          const canvas = document.createElement('canvas');
          const context = canvas.getContext('2d');
          canvas.height = viewport.height;
          canvas.width = viewport.width;
          
          const renderContext = {
            canvasContext: context,
            viewport: viewport
          };
          
          await page.render(renderContext).promise;
          
          const pageDiv = document.createElement('div');
          pageDiv.className = 'pdf-page';
          pageDiv.appendChild(canvas);
          
          const pageNumber = document.createElement('div');
          pageNumber.className = 'pdf-page-number';
          pageNumber.textContent = `Page ${i}`;
          pageDiv.appendChild(pageNumber);
          
          container.insertBefore(pageDiv, container.querySelector('.locked-overlay'));
        }
        
        // Clean up object URL
        URL.revokeObjectURL(pdfUrlObj);
        
      } catch (error) {
        console.error('Error rendering PDF:', error);
        
        // Remove loading indicator if it exists
        const loadingDiv = container.querySelector('.fa-spinner')?.parentNode;
        if (loadingDiv) container.removeChild(loadingDiv);
        
        const errorDiv = document.createElement('div');
        errorDiv.style.padding = '20px';
        errorDiv.style.color = 'var(--danger)';
        errorDiv.style.textAlign = 'center';
        errorDiv.innerHTML = `
          <i class="fas fa-exclamation-triangle"></i> Error loading PDF preview
          <p style="font-size: 0.9rem; margin-top: 10px; color: var(--dark-light);">
            Please try again later or <a href="GPay.html" style="color: var(--primary);">subscribe</a> for full access
          </p>
        `;
        container.insertBefore(errorDiv, container.querySelector('.locked-overlay'));
      }
    }

    // Render all PDFs when page loads
    document.addEventListener('DOMContentLoaded', function() {
      // Only render zoology for now since we have the URL
      renderPDF('zoology-viewer', pdfUrls.zoology);
      
      // These will show errors until you add real URLs
      renderPDF('botany-viewer', pdfUrls.botany);
      renderPDF('chemistry-viewer', pdfUrls.chemistry);
    });

    // Add hover effect for elements on touch devices
    document.addEventListener('touchstart', function() {}, true);
  </script>

</body>
</html>
